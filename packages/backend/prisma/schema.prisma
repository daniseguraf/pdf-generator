generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

generator typescriptInterfaces {
  provider         = "prisma-generator-typescript-interfaces"
  output           = "../../shared/src/types/prisma.types.ts"
  prettier         = true
  modelType        = "type"
  enumType         = "object"
  enumObjectSuffix = "Values"
}

datasource db {
  provider     = "postgresql"
  relationMode = "foreignKeys"
}

// Models
model Building {
  id           Int          @id @default(autoincrement())
  name         String
  description  String?      @db.Text
  yearBuilt    Int          @map("year_built")
  propertyType PropertyType @default(RESIDENTIAL) @map("property_type")
  address      String
  district     String
  city         String
  province     String
  postalCode   String?      @map("postal_code")
  floors       Int
  phoneNumber  String?      @map("phone_number")
  email        String?      @unique
  isActive     Boolean      @default(true) @map("is_active")
  createdAt    DateTime     @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt    DateTime     @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt    DateTime?    @map("deleted_at") @db.Timestamptz(3)
  manager      User         @relation("BuildingManager", fields: [managerId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  managerId    Int          @map("manager_id")
  commonAreas  CommonArea[]
  amenities    Amenities[]
  residents    User[]       @relation("BuildingResident")

  @@map("buildings")
}

model User {
  id           Int           @id @default(autoincrement())
  firstName    String        @map("first_name")
  lastName     String        @map("last_name")
  email        String        @unique
  password     String
  role         UserRole      @default(RESIDENT)
  createdAt    DateTime      @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt    DateTime      @updatedAt @map("updated_at") @db.Timestamptz(3)
  isActive     Boolean       @default(true) @map("is_active")
  reservations Reservation[]
  managedBuildings Building[] @relation("BuildingManager")
  residentBuilding Building?     @relation("BuildingResident", fields: [buildingId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  buildingId   Int?          @map("building_id")

@@index([buildingId])
  @@map("users")
}

model CommonArea {
  id                     Int           @id @default(autoincrement())
  type                   CommonAreas
  buildingId             Int           @map("building_id")
  building               Building      @relation(fields: [buildingId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  description            String?
  capacity               Int
  isActive               Boolean       @default(true) @map("is_active")
  createdAt              DateTime      @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt              DateTime      @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt              DateTime?     @map("deleted_at") @db.Timestamptz(3)
  maxHoursPerReservation Int           @map("max_hours_per_reservation")
  openTime               DateTime       @map("open_time") @db.Time(0)
  closeTime              DateTime       @map("close_time") @db.Time(0)
  daysAvailable          DaysOfWeek[]  @default([]) @map("days_available")
  reservations           Reservation[]

  @@map("common_areas")
}

model Reservation {
  id           Int               @id @default(autoincrement())
  title        String?           @map("title") @db.Text
  commonAreaId Int               @map("common_area_id")
  commonArea   CommonArea        @relation(fields: [commonAreaId], references: [id], onDelete: Cascade)
  userId       Int               @map("user_id")
  user         User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  date         DateTime          @map("date") @db.Date
  startTime    DateTime          @map("start_time") @db.Timestamptz(3)
  endTime      DateTime          @map("end_time") @db.Timestamptz(3)
  status       ReservationStatus @default(IN_REVIEW)
  notes        String?           @db.Text
  attendees    Int
  createdAt    DateTime          @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt    DateTime          @updatedAt @map("updated_at") @db.Timestamptz(3)

  @@index([commonAreaId, startTime, endTime])
  @@index([userId])
  @@map("reservations")
}

enum ReservationStatus {
  IN_REVIEW
  CONFIRMED
  CANCELLED
}

enum PropertyType {
  RESIDENTIAL
  COMMERCIAL
  MIXED
}

enum UserRole {
  ADMIN
  MANAGER
  RESIDENT
}

enum Amenities {
  PARKING
  SECURITY_24_7
  ELEVATOR
  WHEELCHAIR_ACCESS
  WHEELCHAIR_LIFT
  FIRE_ALARM
  CAMERAS
}

enum CommonAreas {
  GYM
  POOL
  GRILL_AREA
  CAFETERIA
  EVENT_ROOM
  ROOF_TOP
  COWORKING
}

enum DaysOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}
