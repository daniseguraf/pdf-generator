generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

generator typescriptInterfaces {
  provider         = "prisma-generator-typescript-interfaces"
  output           = "../../shared/src/types/prisma.types.ts"
  prettier         = true
  modelType        = "type"
  enumType         = "object"
  enumObjectSuffix = "Values"
}

datasource db {
  provider     = "postgresql"
  relationMode = "foreignKeys"
}

// Models
model Building {
  id           Int          @id @default(autoincrement())
  name         String
  description  String?      @db.Text
  yearBuilt    Int          @map("year_built")
  propertyType PropertyType @default(RESIDENTIAL) @map("property_type")
  address      String
  district     String
  city         String
  province     String
  postalCode   String?      @map("postal_code")
  floors       Int
  phoneNumber  String?      @map("phone_number")
  email        String?      @unique
  isActive     Boolean      @default(true) @map("is_active")
  createdAt    DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime     @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt    DateTime?    @map("deleted_at") @db.Timestamptz(6)
  manager      User     @relation(fields: [managerId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  managerId    Int          @map("manager_id")
  // commonAreas  CommonArea[]
  amenities    Amenities[]

  @@map("buildings")
}

model User {
  id          Int          @id @default(autoincrement())
  buildings   Building[]
  firstName   String       @map("first_name")
  lastName    String       @map("last_name")
  email       String       @unique
  password    String
  role        UserRole @default(RESIDENT)
  createdAt   DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime     @updatedAt @map("updated_at") @db.Timestamptz(6)
  isActive    Boolean      @default(true) @map("is_active")

  @@map("users")
}

model Unit {
  id         Int        @id @default(autoincrement())
  buildingId Int        @map("building_id")
  // building   Building   @relation(fields: [buildingId], references: [id])
  number     String
  floor      Int
  type       UnitType
  status     UnitStatus
  createdAt  DateTime   @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime   @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@unique([buildingId, floor, number])
  @@index([buildingId])
  @@map("units")
}

model CommonArea {
  id                     Int           @id @default(autoincrement())
  buildingId             Int           @map("building_id")
  building               Building      @relation(fields: [buildingId], references: [id])
  name                   String
  description            String?
  capacity               Int
  isActive               Boolean       @default(true) @map("is_active")
  createdAt              DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt              DateTime      @updatedAt @map("updated_at") @db.Timestamptz(6)
  maxHoursPerReservation Int           @default(4) @map("max_hours_per_reservation")
  openTime               String        @default("08:00") @map("open_time")
  closeTime              String        @default("22:00") @map("close_time")
  daysAvailable          String[]      @default(["MONDAY", "TUESDAY", "WEDNESDAY", "THURSDAY", "FRIDAY", "SATURDAY", "SUNDAY"]) @map("days_available")
  reservations           Reservation[]

  @@map("common_areas")
}

model Resident {
  id           Int           @id @default(autoincrement())
  firstName    String        @map("first_name")
  lastName     String        @map("last_name")
  phoneNumber  String?       @map("phone_number")
  email        String        @unique
  isActive     Boolean       @default(true) @map("is_active")
  createdAt    DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime      @updatedAt @map("updated_at") @db.Timestamptz(6)
  reservations Reservation[]

  @@map("residents")
}

model Reservation {
  id           Int               @id @default(autoincrement())
  commonAreaId Int               @map("common_area_id")
  commonArea   CommonArea        @relation(fields: [commonAreaId], references: [id], onDelete: Cascade)
  residentId   Int               @map("resident_id")
  resident     Resident          @relation(fields: [residentId], references: [id], onDelete: Cascade)
  startTime    DateTime          @map("start_time") @db.Timestamptz(6)
  endTime      DateTime          @map("end_time") @db.Timestamptz(6)
  status       ReservationStatus @default(CONFIRMED)
  notes        String?           @db.Text
  attendees    Int               @default(1)
  createdAt    DateTime          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime          @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@index([commonAreaId, startTime, endTime])
  @@index([residentId])
  @@map("reservations")
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum UnitType {
  APARTMENT
  OFFICE
  COMMERCIAL
}

enum UnitStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
}

enum PropertyType {
  RESIDENTIAL
  COMMERCIAL
  MIXED
}

enum UserRole {
  ADMIN
  MANAGER
  RESIDENT
}

enum Amenities {
  PARKING
  SECURITY_24_7
  ELEVATOR
  WHEELCHAIR_ACCESS
  WHEELCHAIR_LIFT
  FIRE_ALARM
  CAMERAS
}
